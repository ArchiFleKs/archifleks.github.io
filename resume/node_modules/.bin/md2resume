#!/usr/bin/env node
(function() {
  var fs, input, lib, md2resume, outputFileName, path, pdfOutputFileName, program, sourceFile, sourceFileBasename, sourceFileDir;

  fs = require('fs');

  path = require('path');

  program = require('commander');

  lib = path.join(path.dirname(fs.realpathSync(__filename)), '../lib');

  md2resume = require(path.join(lib, 'markdown-resume'));

  program.usage('[options] [source markdown file]').option('--pdf', 'Output as PDF').option('-t, --template <template>', 'Specify the template html file', path.join(__dirname, '../assets/templates/default.html')).parse(process.argv);

  sourceFile = program.args[0];

  if (!(sourceFile != null)) {
    console.log("No source file specified");
    console.log(program.help());
    process.exit();
  }

  sourceFileBasename = path.basename(sourceFile, path.extname(sourceFile));

  sourceFileDir = path.dirname(sourceFile);

  outputFileName = path.join(sourceFileDir, sourceFileBasename + '.html');

  input = fs.readFileSync(sourceFile, 'utf8');

  if (program.pdf) {
    pdfOutputFileName = path.join(sourceFileDir, sourceFileBasename + '.pdf');
    md2resume.generate(input, {
      format: 'pdf',
      template: program.template
    }, function(err, out) {
      if (err != null) {
        return console.log(err);
      }
      return fs.writeFile(pdfOutputFileName, out, 'binary', function(err) {
        return console.log("Wrote pdf to: " + pdfOutputFileName);
      });
    });
  } else {
    md2resume.generate(input, {
      template: program.template
    }, function(err, out) {
      return fs.writeFile(outputFileName, out, function(err) {
        return console.log("Wrote html to: " + outputFileName);
      });
    });
  }

}).call(this);
